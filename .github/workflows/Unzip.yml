name: Unzip and commit ZIP

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  unzip-and-commit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout main
        uses: actions/checkout@v4
        with:
          ref: main
          persist-credentials: true
          fetch-depth: 0

      - name: Ensure unzip available
        run: sudo apt-get update && sudo apt-get install -y unzip

      - name: Download ZIP
        run: |
          curl -L "https://raw.githubusercontent.com/DaFum/Bromanager/main/obey-codex-start-null-agent-directives-skill.zip" -o /tmp/archive.zip

      - name: Show archive contents
        run: unzip -l /tmp/archive.zip

      - name: Unzip into repository root (overwrite)
        run: unzip -o /tmp/archive.zip -d .

      - name: Show git status
        run: git status --porcelain && git --no-pager diff --name-only

      - name: Commit and push changes to main
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add -A
          if git diff --cached --quiet; then
            echo "No changes to commit."
            exit 0
          fi
          git commit -m "Add files from obey-codex-start-null-agent-directives-skill.zip"
          git push origin HEAD:main
